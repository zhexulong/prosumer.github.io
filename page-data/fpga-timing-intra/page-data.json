{"componentChunkName":"component---src-templates-blog-post-js","path":"/fpga-timing-intra/","result":{"data":{"site":{"siteMetadata":{"title":"且听龙吟"}},"markdownRemark":{"id":"97568629-07b9-5c82-861f-f48facfd2b69","excerpt":"什么是建立时间和保持时间, 为什么需要考虑它们? D触发器 亚稳态问题 (复位中也需要) 时钟从哪里来? FPGA结构\r\n参考 时钟树 Local Clocks In general, avoid using local clocks建议来源 如何确认是否使用了local clocks: 通过report_clock…","html":"<h2 id=\"什么是建立时间和保持时间-为什么需要考虑它们\" style=\"position:relative;\">什么是建立时间和保持时间, 为什么需要考虑它们?<a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BB%BA%E7%AB%8B%E6%97%B6%E9%97%B4%E5%92%8C%E4%BF%9D%E6%8C%81%E6%97%B6%E9%97%B4-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E8%80%83%E8%99%91%E5%AE%83%E4%BB%AC\" aria-label=\"什么是建立时间和保持时间 为什么需要考虑它们 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>D触发器</p>\n<p>亚稳态问题</p>\n<p>(复位中也需要)</p>\n<h2 id=\"时钟从哪里来\" style=\"position:relative;\">时钟从哪里来?<a href=\"#%E6%97%B6%E9%92%9F%E4%BB%8E%E5%93%AA%E9%87%8C%E6%9D%A5\" aria-label=\"时钟从哪里来 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>FPGA结构\r\n<a href=\"https://blog.csdn.net/u011327754/article/details/79897170\">参考</a></p>\n<h3>时钟树</h3>\n<h4 id=\"Local-Clocks\" style=\"position:relative;\">Local Clocks<a href=\"#Local-Clocks\" aria-label=\"Local Clocks permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>In general, avoid using local clocks<a href=\"https://docs.amd.com/r/en-US/ug949-vivado-design-methodology/Avoiding-Local-Clocks\">建议来源</a></p>\n<p>如何确认是否使用了local clocks: 通过report_clock_utilization命令</p>\n<h3>PLL和MCMM</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8fe223c2a9e5762e2369d62e75bc375c/4c42d/pll.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.9873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0ElEQVR42jWQXU+DYAyF+f/3/oH9AmM0msXELV74sRuVjW2AgODiQAZxH7KRJc9amjU5ad++pyendZg9wGIM21KyC78h/HiwzuGwk3oKRWhYzmC/gfZf6jnkAVQp1Jm8fWg2OMSvEL/AUw8GFxAMYdKn6weP8HYJ3j2MbwV3kIzAF44nnOwd3Bv4uBbeFUTPIqiR++ZI8yo1N80fHFurV1+G4lNci7u2kU0iKBPYVeIys3kJEyxjW6H+NkGFDqiADul/lxPrn8XKyLh6Kj0FcAK8bSwW+H/yIQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pll简要结构\"\n        title=\"\"\n        src=\"/static/8fe223c2a9e5762e2369d62e75bc375c/f058b/pll.png\"\n        srcset=\"/static/8fe223c2a9e5762e2369d62e75bc375c/c26ae/pll.png 158w,\n/static/8fe223c2a9e5762e2369d62e75bc375c/6bdcf/pll.png 315w,\n/static/8fe223c2a9e5762e2369d62e75bc375c/f058b/pll.png 630w,\n/static/8fe223c2a9e5762e2369d62e75bc375c/4c42d/pll.png 896w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\nPLL（Phase Locked Loop），生成时钟的核心部分是 压控振荡器 （Voltage-Controlled Oscillator，VCO）。它是可根据 输入的电压调整输出频率 的振荡器，如上图所示。\r\n它的基本原理是通过 负反馈 形成闭环从而根据输入的基准时钟控制输出时钟。其中鉴相器就相当于一个 比较器 ，它根据基准时钟和输出时钟的差值转换为控制电压，输出到低通滤波器滤除高频杂波，然后输入到VCO，VCO主频过高则降低电压，反之提升电压，使输出时钟跟随给定的基准时钟。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/22296b933e5aee38dc1b936cd43a2253/a6ec4/pll-detail.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.354430379746837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyUlEQVR42lWPC0vDQBCE8/9/kSBKLVgrilYxRhNNm5ex9pHEJmkpMZ9zPUFdGJid3Zudc6hy+HyHSijFNx8ctHoJu1qzubSFnRnerG1fr2xv0FZQpDD3cViEMLuCZALRDYSX4B5BLJ7ew+uF5tfid+IjyD09fIZgqN0xTLX/5koLIHNlaKrvLb46e735uW5MIpm9nMvoUXqhZEpYZuAdgz+Ap1OF0d46ORyTYc//+tObL29LfUlG3f5Xb6V5JzI8s4hvYTlT0ge+AQ8rL7qxxuioAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pll详细结构\"\n        title=\"\"\n        src=\"/static/22296b933e5aee38dc1b936cd43a2253/f058b/pll-detail.png\"\n        srcset=\"/static/22296b933e5aee38dc1b936cd43a2253/c26ae/pll-detail.png 158w,\n/static/22296b933e5aee38dc1b936cd43a2253/6bdcf/pll-detail.png 315w,\n/static/22296b933e5aee38dc1b936cd43a2253/f058b/pll-detail.png 630w,\n/static/22296b933e5aee38dc1b936cd43a2253/40601/pll-detail.png 945w,\n/static/22296b933e5aee38dc1b936cd43a2253/78612/pll-detail.png 1260w,\n/static/22296b933e5aee38dc1b936cd43a2253/a6ec4/pll-detail.png 1438w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n上图为PLL的详细结构。</p>\n<p>基准时钟经过分频器后输出频率为 Fref/N ，并输入到鉴相器 。\r\n为了要让鉴相器与反馈频率相同，VCO的输出频率Fvco需要让反馈频率在经过反馈时钟分频器后输出到鉴相器的频率和分频后的基准时钟频率相同，所以 Fvco=M/N·Fref 。\r\nFvco经过输出时钟分频器输出的时钟为 Fi=Fref·M/(N·Ki) ，其中Fi为输出频率，Fref为基准时钟的频率，Ki为输出时钟分频比，N为基准时钟分频比，M为反馈时钟分频比。</p>\n<p>MMCM是一种带有附加逻辑的 PLL，用于进行精细相位调整。因此，MMCM 的相位略优于 PLL，但本质上它们都是 PLL。(The MMCM is a PLL with additional logic to do fine phase adjustments. So, the MMCM has slight phase advantages over the PLL, but at the heart they are both PLLs.MMCM )<a href=\"https://www.reddit.com/r/FPGA/comments/13zcqrk/mmcm_vs_pll/\">参考</a>与<a href=\"https://adaptivesupport.amd.com/s/question/0D52E00006hpaHISAY/dcm-mmcm-and-pll?language=en_US\">更详细的解释</a></p>\n<h2 id=\"什么造成了时序收敛失败\" style=\"position:relative;\">什么造成了时序收敛失败?<a href=\"#%E4%BB%80%E4%B9%88%E9%80%A0%E6%88%90%E4%BA%86%E6%97%B6%E5%BA%8F%E6%94%B6%E6%95%9B%E5%A4%B1%E8%B4%A5\" aria-label=\"什么造成了时序收敛失败 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>report_design_analysis/report timing summary查看时序分析报告,分析logic level, logic delay, net delay(route delay), fanout等信息。Clock Skew，当其绝对值超过 500ps 时，应引起关注。Clock Uncertainty，当该数值超过 100ps 时，应引起关注。<a href=\"https://www.sunev.cn/embedded/1277.html\">来源</a></p>\n<p>通过report_qor_suggestions生成结果质量 (QoR) 评估报告 (Report Quality of Results (QoR) Assessment)将逻辑层次检查、利用率检查和最常用的时钟拓扑结构检查组合到单一汇总报告中，以便为您提供总体设计评估。此报告可帮助您了解时序收敛问题的严重性。<a href=\"https://docs.amd.com/r/2021.1-%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87/ug949-vivado-design-methodology/%E5%A4%8D%E6%9F%A5%E7%BB%BC%E5%90%88%E6%97%A5%E5%BF%97\">来源</a></p>\n<h3>fanout过大</h3>\n<p>导致:</p>\n<ol>\n<li>布线拥塞</li>\n<li>驱动能力变弱(下级电路的输入电容增大, transition所需时间增大)</li>\n</ol>\n<h4 id=\"诊断方法\" style=\"position:relative;\">诊断方法<a href=\"#%E8%AF%8A%E6%96%AD%E6%96%B9%E6%B3%95\" aria-label=\"诊断方法 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>查看timing summary</p>\n<h4 id=\"解决办法\" style=\"position:relative;\">解决办法<a href=\"#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95\" aria-label=\"解决办法 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<ol>\n<li>寄存器复制</li>\n<li>verilog/xdc中设置max_fanout属性</li>\n<li>设置MAX_FANOUT</li>\n<li>BUFG增加时钟扇出</li>\n</ol>\n<h3>net delay过高, route过长</h3>\n<h4 id=\"诊断方法-1\" style=\"position:relative;\">诊断方法<a href=\"#%E8%AF%8A%E6%96%AD%E6%96%B9%E6%B3%95-1\" aria-label=\"诊断方法 1 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<blockquote>\n<p>对于违例路径，若布线延迟超过 50%，说明该延迟是导致时序不能收敛的主要因素，因此可围绕降低布线延迟这一靶心达到时序收敛。</p>\n</blockquote>\n<p><a href=\"https://www.sunev.cn/embedded/1277.html\">来源</a></p>\n<h4 id=\"解决办法-1\" style=\"position:relative;\">解决办法<a href=\"#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95-1\" aria-label=\"解决办法 1 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<h5>set_input_delay/set_output_delay/set_max_delay</h5>\n<ul>\n<li>set_input_delay: 指定输入<strong>数据</strong>引脚相对于其时钟沿的路径延时</li>\n<li>set_output_delay: 指定输出<strong>数据</strong>引脚相对于其时钟沿的路径延时</li>\n<li>set_max_delay:  设置数据路径的最大延迟(-from -to)</li>\n</ul>\n<p>参数:</p>\n<ul>\n<li>max: 定义了输入信号到达端口的最迟时间，用于建立时间分析</li>\n<li>min: 定义了输入信号到达端口的最快时间，用于保持时间分析。(延时太小，FPGA端的保持时间可能不满足)</li>\n</ul>\n<p>调FPGA内部时序的时候，端口的时序可以先放一下，比如set_input_delay, set_put_delay 约束可以先不加，再看一下整个设计的跑的情况，看下有问题的路径，确定如何来优化时序.<a href=\"https://adaptivesupport.amd.com/s/question/0D52E00006hpoB7SAI/fpga%E6%97%B6%E9%92%9F%E8%B7%AF%E5%BE%84%E4%B8%8A%E7%9A%84%E5%BB%B6%E6%97%B6%E8%BF%87%E5%A4%A7%E8%AF%A5%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86?language=en_US\">来源</a></p>\n<p><a href=\"https://blog.csdn.net/FPGADesigner/article/details/82873906\">set_input_delay/set_output_delay</a></p>\n<h3>logic level过高, logic delay过高, data path过长</h3>\n<h4 id=\"诊断方法-2\" style=\"position:relative;\">诊断方法<a href=\"#%E8%AF%8A%E6%96%AD%E6%96%B9%E6%B3%95-2\" aria-label=\"诊断方法 2 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<p>Logic Level Distribution分析延时原因<a href=\"https://blog.csdn.net/zyp626/article/details/139554448\">详解</a></p>\n<p>一个经验法则是，LUT（查找表）加上NET（网络）的延迟大约是0.5ns。如果时钟周期为5ns，则电路中最大的级联数应该是5ns / 0.5ns = 10级\r\n<a href=\"https://blog.csdn.net/yundanfengqing_nuc/article/details/108626269\">来源</a></p>\n<h4 id=\"解决办法-2\" style=\"position:relative;\">解决办法<a href=\"#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95-2\" aria-label=\"解决办法 2 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<h5>流水线化</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 594px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dbabbd8e21ae7f001d5b494c1f828540/5fd3e/before-pipeline.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.354430379746837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAp0lEQVR42k2Pyw6FIBBD/f8f9LEw4MYYBd+iCKlOc7lxEhactNNpht+EEDBNE7qu4/Pe475vsrZt0fc9/8ITG4aB7DuZwG3bcJ4nhWVZoq5rsuM4yIqigNYay7KQWWuR5znZvu//Y2QXF4roui4Kq6pC0zQ0O+dgjGGIUgrrupKJR0KU0q/XceE4jmyWpVNjjJjnmUslTQK+TAxSN12TdP6tHENkddE/HLExem7LQocAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"before-pipeline\"\n        title=\"\"\n        src=\"/static/dbabbd8e21ae7f001d5b494c1f828540/5fd3e/before-pipeline.png\"\n        srcset=\"/static/dbabbd8e21ae7f001d5b494c1f828540/c26ae/before-pipeline.png 158w,\n/static/dbabbd8e21ae7f001d5b494c1f828540/6bdcf/before-pipeline.png 315w,\n/static/dbabbd8e21ae7f001d5b494c1f828540/5fd3e/before-pipeline.png 594w\"\n        sizes=\"(max-width: 594px) 100vw, 594px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n这是原本只有组合逻辑电路的设计，组合逻辑总延迟为total_delay = delay1 + delay2 + delay3</p>\n<p>并且我们要求total_delay &#x3C; clock_period</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9921830c03ea80b874fd115daf78c38/55843/after-pipeline.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.088607594936708%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3QUD/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxAAAwEAAAAAAAAAAAAAAAAAABARQf/aAAgBAQABPyHVD//aAAwDAQACAAMAAAAQgA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAEAAgMAAAAAAAAAAAAAAAABABFRgeH/2gAIAQEAAT8QSQK3mArs/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"after-pipeline\"\n        title=\"\"\n        src=\"/static/d9921830c03ea80b874fd115daf78c38/828fb/after-pipeline.jpg\"\n        srcset=\"/static/d9921830c03ea80b874fd115daf78c38/ff44c/after-pipeline.jpg 158w,\n/static/d9921830c03ea80b874fd115daf78c38/a6688/after-pipeline.jpg 315w,\n/static/d9921830c03ea80b874fd115daf78c38/828fb/after-pipeline.jpg 630w,\n/static/d9921830c03ea80b874fd115daf78c38/55843/after-pipeline.jpg 928w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>这是流水线化后的设计，中间添加了寄存器，由此组合逻辑被分成了三个阶段，每个阶段的延迟为delay1, delay2, delay3</p>\n<p>我们只需要max{delay1, delay2, delay3} &#x3C; clock_period即可</p>\n<p>虽然信号传递时长增加了,但是每个输出数据之间间隔依旧是只有一个时钟周期,并且允许更高的时钟频率</p>\n<blockquote>\n<p>建议数据输出到管脚前用寄存器打一拍，这样IO上的时序比较容易满足。这条路径如果在输出前用寄存器打一拍时序就很容易满足了</p>\n</blockquote>\n<p><a href=\"https://adaptivesupport.amd.com/s/question/0D52E00006hpoB7SAI/fpga%E6%97%B6%E9%92%9F%E8%B7%AF%E5%BE%84%E4%B8%8A%E7%9A%84%E5%BB%B6%E6%97%B6%E8%BF%87%E5%A4%A7%E8%AF%A5%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86?language=en_US\">来源</a></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 288px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a66ecffab114e1bf977ce70da8b3cd3/c14c5/2-level-pipeline-before.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd0pAX//xAAYEAACAwAAAAAAAAAAAAAAAAAAARARIf/aAAgBAQABBQIvRz//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhEEH/2gAIAQEAAT8hdTalsVDfKgFO/wD/2gAMAwEAAgADAAAAEHQP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFRYf/aAAgBAQABPxA2l1eew0HVdiRavhjmm3HCE//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"alt text\"\n        title=\"\"\n        src=\"/static/8a66ecffab114e1bf977ce70da8b3cd3/c14c5/2-level-pipeline-before.jpg\"\n        srcset=\"/static/8a66ecffab114e1bf977ce70da8b3cd3/ff44c/2-level-pipeline-before.jpg 158w,\n/static/8a66ecffab114e1bf977ce70da8b3cd3/c14c5/2-level-pipeline-before.jpg 288w\"\n        sizes=\"(max-width: 288px) 100vw, 288px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n将上图通过流水线化优化后得到下图\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 609px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/694e2346eb352c20fec90d20d9ba2ae6/51891/2-level-pipeline.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwACBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB7pKWT2av/8QAGBABAAMBAAAAAAAAAAAAAAAAAAECETH/2gAIAQEAAQUCbGpWV5//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQIBAT8BMX//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAEAAgMBAAAAAAAAAAAAAAABABEQITFB/9oACAEBAAE/IX2+QEapg2QQDWP/2gAMAwEAAgADAAAAEGwv/8QAFxEBAAMAAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxALyP/EABcRAQEBAQAAAAAAAAAAAAAAAAERAEH/2gAIAQIBAT8QaUcw0u//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMVFBYf/aAAgBAQABPxCrVWsVMAQ0vkqHsCr+ktFZdvdSwBVrs//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"二阶流水线\"\n        title=\"\"\n        src=\"/static/694e2346eb352c20fec90d20d9ba2ae6/51891/2-level-pipeline.jpg\"\n        srcset=\"/static/694e2346eb352c20fec90d20d9ba2ae6/ff44c/2-level-pipeline.jpg 158w,\n/static/694e2346eb352c20fec90d20d9ba2ae6/a6688/2-level-pipeline.jpg 315w,\n/static/694e2346eb352c20fec90d20d9ba2ae6/51891/2-level-pipeline.jpg 609w\"\n        sizes=\"(max-width: 609px) 100vw, 609px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>上图为二阶流水线</p>\n<ul>\n<li>K阶流水线（“k-pipeline”）是一种无循环电路，其在从输入到输出的每个路径上具有恰好k个寄存器。因此，组合电路是0阶流水线。</li>\n<li>k阶流水线的延迟是所有寄存器通用时钟的k倍。</li>\n<li>k阶流水线的吞吐量是时钟的频率。</li>\n</ul>\n<p><a href=\"https://www.ebaina.com/articles/140000012360\">参考A</a></p>\n<p><a href=\"https://www.ebaina.com/articles/140000012361\">参考B</a></p>\n<h5>手动retiming优化</h5>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 438px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5000dcb94e9ef903f8c40e425771913f/854eb/retiming.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.21518987341772%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHasJIX/8QAGBABAAMBAAAAAAAAAAAAAAAAAQARMTL/2gAIAQEAAQUCenAqf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABUQAQEAAAAAAAAAAAAAAAAAABAR/9oACAEBAAY/Aq//xAAZEAADAAMAAAAAAAAAAAAAAAAAAREhMWH/2gAIAQEAAT8hSNzowQklbP/aAAwDAQACAAMAAAAQh8//xAAWEQEBAQAAAAAAAAAAAAAAAAAAATH/2gAIAQMBAT8QjH//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAXEAADAQAAAAAAAAAAAAAAAAABESEA/9oACAEBAAE/EH5Qgy6bFivWNnf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"retiming\"\n        title=\"\"\n        src=\"/static/5000dcb94e9ef903f8c40e425771913f/854eb/retiming.jpg\"\n        srcset=\"/static/5000dcb94e9ef903f8c40e425771913f/ff44c/retiming.jpg 158w,\n/static/5000dcb94e9ef903f8c40e425771913f/a6688/retiming.jpg 315w,\n/static/5000dcb94e9ef903f8c40e425771913f/854eb/retiming.jpg 438w\"\n        sizes=\"(max-width: 438px) 100vw, 438px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n上图将一组寄存器从组合逻辑的左边移动到另一边，改善了右边时序的压力，但也会增加左边逻辑的压力</p>\n<p>如果一方的压力较大，一方的压力较小，就可以通过这种切割关键路径的方式改善关键路径时序(关键时序路径就是延迟最大的路径)。</p>\n<p><a href=\"https://www.ebaina.com/articles/140000012361\">参考</a></p>\n<h5>自动retiming优化</h5>\n<ul>\n<li>\n<p>RETIMING_FORWARD: 寄存器沿着逻辑链向前移动，即向驱动顺序元件的方向移动(register forward through logic closer to the driven sequential elements)<a href=\"https://docs.amd.com/r/en-US/ug901-vivado-synthesis/RETIMING_FORWARD\">RETIMING_FORWARD官方文档</a></p>\n</li>\n<li>\n<p>RETIMING_BACKWARD: 寄存器沿着逻辑链向后移动，即向顺序驱动元件的方向移动(register backward through logic closer to the sequential driving elements)<a href=\"https://docs.amd.com/r/en-US/ug901-vivado-synthesis/RETIMING_BACKWARD\">RETIMING_BACKWARD官方文档</a></p>\n</li>\n</ul>\n<h2 id=\"仍有参考价值的资料\" style=\"position:relative;\">仍有参考价值的资料<a href=\"#%E4%BB%8D%E6%9C%89%E5%8F%82%E8%80%83%E4%BB%B7%E5%80%BC%E7%9A%84%E8%B5%84%E6%96%99\" aria-label=\"仍有参考价值的资料 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li><a href=\"https://blog.csdn.net/zyp626/category_11915436.html\">FPGA所知所见所解(专栏)</a></li>\n<li><a href=\"https://www.ebaina.com/blog/article/200000090893\">FPGA博客by李锐博恩</a></li>\n</ul>","frontmatter":{"title":"fpga intra-clock时序分析","date":"September 29, 2024","description":null}},"previous":{"fields":{"slug":"/rviz2_h1_robot/"},"frontmatter":{"title":"在rviz2中仿真并操控h1机器人"}},"next":null},"pageContext":{"id":"97568629-07b9-5c82-861f-f48facfd2b69","previousPostId":"7b5757a4-295f-5005-ac49-376e23efbb52","nextPostId":null}},"staticQueryHashes":["230163734","2841359383"],"slicesMap":{}}